<html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script>

    $(function () {
        const urlParams = new URLSearchParams(window.location.search);

        const token = urlParams.get('p');

        console.log(token)

        $.ajax({
            "async": true,
            "crossDomain": true,
            "url": "https://ambep-api-2.azurewebsites.net/api/v1/Publico/RecuperarSenha/ValidarToken/" + token,
            "method": "GET",
            "headers": {
                "cache-control": "no-cache"
            }
        }).done((response) => {
            console.log(response);
            $('#div-loading').hide();
            $('#div-formulario').show();
        }).fail((response) => {
            console.log(response.responseText);
            $('#div-loading').hide();
            $('#div-erro').show();
            $('#div-mensagem-erro').html(response.responseText);
        });

        $('#btnSalvar').click(() => {

            $('#div-formulario').hide();            
            $('#div-loading').show();
            $.ajax({
                "async": true,
                "crossDomain": true,
                "url": "https://ambep-api-2.azurewebsites.net/api/v1/Publico/RecuperarSenha/AlterarSenha",
                "method": "PUT",
                "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                "processData": false,
                "data": "{\r\n  \"token\": \"" + token + "\",\r\n  \"novaSenha\": \"" + $('#txtNovaSenha').val() + "\",\r\n  \"confirmacaoSenha\": \"" + $('#txtConfirmacaoSenha').val() + "\"\r\n}"
            }).done((response) => {

                console.log(response);
                $('#div-loading').hide();
                $('#div-sucesso').show();
            }).fail((response) => {
                console.log(response.responseText);
                $('#div-loading').hide();
                $('#div-erro').show();
                $('#div-mensagem-erro').html(response.responseText);
            });
        })
    });


</script>

<body class="container">

    <div class="text-center mt-5" id="div-loading">
        <img src="logo-ambep.png">
        <br>
        <div>
            <h3>AGUARDE</h3>
        </div>
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Aguarde...</span>
        </div>
    </div>

    <div class="text-center mt-5" id="div-erro" style="display: none;">
        <img src="logo-ambep.png">
        <div>
            <br>
            <h3>NÃO SERÁ POSSÍVEL ALTERAR A SENHA</h3>
            <br>
            Motivo:
            <div class="h3" id="div-mensagem-erro"></div>
            <br>
            <div class="h4">
                Tente recuperar a senha novamente e fique atento porque esse processo tem prazo para ser concluído.
            </div>
        </div>
    </div>
    <div class="text-center mt-5" id="div-sucesso" style="display: none;">
        <img src="logo-ambep.png">
        <div>
            <br>
            <h3>SENHA ALTERADA COM SUCESSO</h3>            
            <br>
            <div class="h4">
                Acesse o aplicativo e informe a senha que acabou de cadastrar
            </div>
        </div>
    </div>

    <div class="container-md container-fluid mt-5" id="div-formulario" style="display: none;">
        <div class="card">
            <div class="card-body">
                <img src="logo-ambep.png">
                <div>
                    <h3>ALTERAR SENHA</h3>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="txtNovaSenha" maxlength="20"
                        placeholder="Nova Senha">
                    <label for="txtNovaSenha">Nova Senha</label>
                </div>
                <div class="form-floating">
                    <input type="password" class="form-control" id="txtConfirmacaoSenha" maxlength="20"
                        placeholder="Confirmar Senha">
                    <label for="txtConfirmacaoSenha">Confirmar Senha</label>
                </div>
                <br />
                <div>
                    <button id="btnSalvar" type="button" class="btn btn-primary">Alterar</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>